<!DOCTYPE html>
<html>
    <head>
        
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</title>
        <link rel="stylesheet" type="text/css" href="styles.css">
    
    </head>
    <body>



        <div class="container">
            <h1>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h1>
            <form id="registrationForm">
                <label for="email">–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞:</label>
                <input type="email" id="email" name="email" required>
                <div id="message" class="message"></div>
    
                <div class="password-container hidden">
                    <label for="password">–ü–∞—Ä–æ–ª—å:</label>
                    <input type="password" id="password" name="password" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" minlength="4" maxlength="10" required>
                    <span class="toggle-password" data-target="#password">üëÅÔ∏è</span>
                </div>
    
                <div class="password-container hidden">
                    <label for="confirm-password">–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å:</label>
                    <input type="password" id="confirm-password" placeholder="–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" minlength="4" maxlength="10" required>
                    <span class="toggle-password" data-target="#confirm-password">üëÅÔ∏è</span>
                </div>
    
                <input type="submit" id="registration-button"value="–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è"  class="hidden">
                <button type="submit" id="login-button" class="hidden">–í–û–ô–¢–ò</button>
    
                <input type="button" id="sendVerifCode" value="–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥ –Ω–∞ –∏–º–µ–π–ª" onclick="sendVerificationCode()">
    
                <div id="verificationCodeWindow" class="hidden">
                    <input type="text" id="verificationCodeInput"class="hidden" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥">
                    <input type="button" id="ConfirmationCodeInput" value="–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å"class="hidden" onclick="verifyVerificationCode()">
                </div>
            </form>
            <div id="messageOk" class="messageOk"></div>
        </div>
      











            <script>
                const togglePasswordIcons = document.querySelectorAll('.toggle-password');
        
                togglePasswordIcons.forEach(icon => {
                    icon.addEventListener('click', () => {
                        const target = document.querySelector(icon.getAttribute('data-target'));
                        const type = target.getAttribute('type') === 'password' ? 'text' : 'password';
                        target.setAttribute('type', type);
                    });
                });
            </script>




               <script>
                document.addEventListener('DOMContentLoaded', function() {
                    const passwordInput = document.getElementById('password');
                    const confirmPasswordInput = document.getElementById('confirm-password');
                    const form = document.getElementById('registrationForm');
                    const messageDiv = document.getElementById('messageOk');
                    const registrationButton = document.getElementById('registration-button');
                    const loginButton = document.getElementById('login-button');
        
                    form.addEventListener('submit', (event) => {
                        event.preventDefault();
        
                        if (passwordInput.value !== confirmPasswordInput.value) {
                            alert('–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç!');
                        } else {
                            const formData = new FormData(form);
                            const formDataJson = {};
        
                            formData.forEach((value, key) => {
                                formDataJson[key] = value;
                            });
        
                            const xhr = new XMLHttpRequest();
                            xhr.open("POST", "/api/auth/signup");
                            xhr.setRequestHeader("Content-Type", "application/json");
        
                            xhr.onreadystatechange = function() {
                                if (xhr.readyState === XMLHttpRequest.DONE) {
                                    if (xhr.status === 201) {
                                        const response = JSON.parse(xhr.responseText);
                                        console.log("–£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥.");
                                        messageDiv.innerText = "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ!";
                                        messageDiv.style.color = 'green';
        
                                        registrationButton.style.display = 'none';
                                        loginButton.style.display = 'block';
                                        console.log("–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ!");
                                    } else {
                                        console.error("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏.");
                                    }
                                }
                            };
        
                            xhr.send(JSON.stringify(formDataJson));
                        }
                    });
        

                  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–í–û–ô–¢–ò"
               
                  loginButton.addEventListener('click', () => {
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;

                const loginDataParams = new URLSearchParams();
                loginDataParams.append('username', email); // –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ 'username'
                loginDataParams.append('password', password);

                const xhr = new XMLHttpRequest();
                xhr.open("POST", "/api/auth/login");
                xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");

                xhr.onreadystatechange = function() {
                    if (xhr.readyState === XMLHttpRequest.DONE) {
                        if (xhr.status === 200) {
                            const response = JSON.parse(xhr.responseText);
                            console.log("–í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ!");
                            messageDiv.innerText = "–í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ!";
                            messageDiv.style.color = 'green';

                                 // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞ —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—Ö–æ–¥–∞
                            setTimeout(() => {
                                window.location.href = "https://cor-platform.azurewebsites.net/?access_token=" + response.access_token;
                            }, 500);
                           

                        } else {
                            console.error("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –≤—Ö–æ–¥–µ.");
                            messageDiv.innerText = "–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞.";
                            messageDiv.style.color = 'red';
                        }
                    }
                };

                xhr.send(loginDataParams.toString());
            });










                    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–∏–¥–∏–º–æ—Å—Ç–∏ –ø–∞—Ä–æ–ª—è
                    function togglePasswordVisibility(event) {
                        const targetInput = document.querySelector(event.currentTarget.dataset.target);
                        if (targetInput.type === 'password') {
                            targetInput.type = 'text';
                        } else {
                            targetInput.type = 'password';
                        }
                    }
        
                    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –∏–∫–æ–Ω–æ–∫ –ø–æ–∫–∞–∑–∞ –ø–∞—Ä–æ–ª—è
                    document.querySelectorAll('.toggle-password').forEach(function(element) {
                        element.addEventListener('click', togglePasswordVisibility);
                    });
                });
            </script>










        <script>
         
            function sendVerificationCode() {
                var form = document.getElementById("registrationForm");
                var emailInput = form.elements.email;
                var messageDiv = document.getElementById("message");
                var email = emailInput.value;

                var xhr = new XMLHttpRequest();
                xhr.open("POST", "/api/auth/send_verification_code");
                xhr.setRequestHeader("Content-Type", "application/json");

                xhr.onreadystatechange = function() {
                if (xhr.readyState === XMLHttpRequest.DONE) {
                    if (xhr.status === 200) {
                    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —É—Å–ø–µ—à–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
                    alert('–ö–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ –í–∞—à—É –ø–æ—á—Ç—É!');
                    console.log("–ö–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ –≤–∞—à—É —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—É—é –ø–æ—á—Ç—É.");
                    showVerificationCodeInput(); // –ü–æ–∫–∞–∑–∞—Ç—å –æ–±–ª–∞—Å—Ç—å –¥–ª—è –≤–≤–æ–¥–∞ –∫–æ–¥–∞
                    document.getElementById('message').style.display = 'none';  

                    document.getElementById('ConfirmationCodeInput').style.display = 'block';
                    document.getElementById('verificationCodeInput').style.display = 'block';  
                  
                    } else {
                    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏
                               // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏
                        var error = JSON.parse(xhr.responseText);
                        console.error("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∫–æ–¥–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –Ω–∞ –ø–æ—á—Ç—É.");
                        messageDiv.innerText = error.detail || "–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∫–æ–¥–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –Ω–∞ –ø–æ—á—Ç—É.";
                        messageDiv.style.color = 'red';

                    console.error("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∫–æ–¥–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –Ω–∞ –ø–æ—á—Ç—É.");
                        }
                    }
                };

                xhr.send(JSON.stringify({ email: email }));
            }

            function showVerificationCodeInput() {
                var verificationCodeWindow = document.getElementById("verificationCodeWindow");
                verificationCodeWindow.style.display = "block";
                
            }

            function verifyVerificationCode() {
                var verificationCodeInput = document.getElementById("verificationCodeInput");
                var emailInput = document.getElementById("email");

                var email = emailInput.value;
                var verificationCode = verificationCodeInput.value;

                var xhr = new XMLHttpRequest();
                xhr.open("POST", "/api/auth/confirm_email");
                xhr.setRequestHeader("Content-Type", "application/json");

                xhr.onreadystatechange = function() {
                    if (xhr.readyState === XMLHttpRequest.DONE) {
                        if (xhr.status === 200) {
                            // –û–±—Ä–∞–±–æ—Ç–∫–∞ —É—Å–ø–µ—à–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
                            console.log("–ö–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤–µ—Ä–Ω—ã–π.");
                            alert('–í–∞—à–∞ –ø–æ—á—Ç–∞ —É—Å–ø–µ—à–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞!!!');
                            
                                const containers = document.querySelectorAll('.password-container');
                                containers.forEach(container => {  container.style.display = 'block';});
                                document.getElementById('sendVerifCode').style.display = 'none';
                                document.getElementById('registration-button').style.display = 'block';  
                                document.getElementById('ConfirmationCodeInput').style.display = 'none';
                                document.getElementById('verificationCodeInput').style.display = 'none';  
                                document.getElementById('message').style.display = 'none';  
                        } else {
                            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏
                            console.error("–ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è.");
                            alert('–ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è!!!');

                            const containers = document.querySelectorAll('.password-container');
                                   containers.forEach(container => { container.style.display = 'none';   });
                        }
                    }
                };

                xhr.send(JSON.stringify({ email: email, verification_code: verificationCode }));
            }
        </script>
    </body>
</html>